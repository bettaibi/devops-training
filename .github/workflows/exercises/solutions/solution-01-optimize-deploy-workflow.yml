# Exercise 1: Optimize Deploy Workflow
#
# GOAL: Fix and optimize the deploy-web-workflow.yml
#
# Requirements:
# 1. Use the correct version of actions/setup-node (v4, not v6)
# 2. Combine 'build' and 'test' into a single 'ci' job that:
#    - Runs tests first (npm test)
#    - Then builds (npm run build)
# 3. Add npm caching using the built-in cache feature
# 4. Keep the 'deploy' job dependent on the new 'ci' job
#
# Reference: ../deploy-web-workflow.yml (original file)
#
# YOUR SOLUTION BELOW:
# ====================

name: Deploy Web component (Exercise 1)
# NOTE: Using workflow_dispatch to prevent auto-running when pushing
# To test: Go to Actions tab → Select this workflow → "Run workflow"
on:
  workflow_dispatch:
jobs:
  build-and-test:
    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: ./components/web
    steps:
      - name: checkout repo
        uses: actions/checkout@v4
      - name: setup node
        uses: actions/setup-node@v4
        with:
          node-version: 22
          cache: 'npm'
          cache-dependency-path: ./components/web/package-lock.json
      - name: install dependencies
        run: npm ci
      - name: run tests
        run: npm test
      - name: run build
        run: npm run build
  deploy:
    runs-on: ubuntu-latest
    needs: [build-and-test]
    steps:
      - name: deploy
        run: echo "Deploying..."
